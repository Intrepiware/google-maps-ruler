!function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.returnExportsGlobal=b()}):"object"==typeof exports?module.exports=b():a.gmruler=b()}(this,function(){var a,b,c,d,e={}.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};return a=google.maps,b=a.event,d={init:function(a,c){return this.map=a,this.options=null!=c?c:{},this.points=[],this.createLine(),b.addListener(this.map,"rightclick",function(a){return function(b){return a.addPoint(b.latLng)}}(this))},createLine:function(){return this.line?void 0:(this.line=new a.Polyline({path:[],strokeColor:this.options.strokeColor||"#ff0000",strokeWeight:this.options.strokeWeight||2}),this.line.setMap(this.map))},addPoint:function(a){var b,d;return b=this.points.length,this.line.getPath().push(a),d=new c(this.map,a,b,this,this.options),this.points.push(d),this.updateDistance(b)},removePoint:function(a){return this.pointRemoved(a)},calculateDistance:function(b,c){return a.geometry.spherical.computeDistanceBetween(b,c)},pointPositionUpdated:function(a,b){return this.line.getPath().setAt(a,b),this.updateDistance(a)},pointRemoved:function(a){return 0!==a?(this.line.getPath().removeAt(a),this.points.splice(a,1),this.updateIndex(a),this.updateDistance(a)):void 0},updateDistance:function(a){var b,c,d,e;for(1>a&&(a=1),e=[],b=c=a,d=this.points.length;d>=a?d>c:c>d;b=d>=a?++c:--c)this.points[b].distance=this.points[b-1].distance+this.calculateDistance(this.positionAt(b-1),this.positionAt(b)),e.push(this.points[b].updateDistance());return e},updateIndex:function(a){var b,c,d,e;for(1>a&&(a=1),e=[],b=c=a,d=this.points.length;d>=a?d>c:c>d;b=d>=a?++c:--c)e.push(this.points[b].index=this.points[b].index-1);return e},positionAt:function(a){return this.line.getPath().getAt(a)}},c=function(c){function d(a,b,c,d,e){this.map=a,this.position=b,this.index=c,this.observer=d,this.options=null!=e?e:{},this.container=document.createElement("div"),this.container.className="gmruler-label",this.distance=0===this.index?0:-1,this.setMap(this.map)}return f(d,c),d.prototype.onAdd=function(){var c;return this.updateDistance(),this.container.draggable=!0,this.eventListeners=[b.addDomListener(this.container,"mousedown",function(c){return function(d){return c.map.set("draggable",!1),c.set("origin",d),c.moveHandler=b.addDomListener(c.map.getDiv(),"mousemove",function(b){var d,e,f,g,h;return f=c.get("origin"),e=f.clientX-b.clientX,h=f.clientY-b.clientY,g=c.getProjection().fromLatLngToDivPixel(c.position),d=c.getProjection().fromDivPixelToLatLng(new a.Point(g.x-e,g.y-h)),c.set("origin",b),c.set("position",d),c.draw(),c.observer&&c.observer.pointPositionUpdated?c.observer.pointPositionUpdated(c.index,d):void 0})}}(this)),b.addDomListener(this.container,"mouseup",function(a){return function(){return a.map.set("draggable",!0),b.removeListener(a.moveHandler)}}(this)),b.addDomListener(this.container,"dblclick",function(a){return function(b){return 0!==a.index?(a.onRemove(),a.observer&&a.observer.pointRemoved&&a.observer.pointRemoved(a.index),a.stopEvent(b)):void 0}}(this))],c=this.getPanes(),c.floatPane.appendChild(this.container)},d.prototype.draw=function(){var a;return a=this.getProjection().fromLatLngToDivPixel(this.position),this.container.style.left=a.x+"px",this.container.style.top=a.y+"px"},d.prototype.updateDistance=function(){var a;return a=function(){switch(this.options.distanceUnit){case"mile":return(621371e-9*this.distance).toFixed(2)+" mile(s)";default:return(this.distance/1e3).toFixed(2)+" km"}}.call(this),this.container.innerHTML=this.distance>0?a:0===this.distance?"Start":""},d.prototype.onRemove=function(){var a,c,d,e,f;for(this.container.parentNode.removeChild(this.container),e=this.eventListeners,f=[],c=0,d=e.length;d>c;c++)a=e[c],f.push(b.removeListener(a));return f},d.prototype.stopEvent=function(a){return a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,a.stopPropagation?a.stopPropagation():void 0},d}(a.OverlayView),d});